# ๐๏ธ ูุณุชูุฏุงุช ุฌุงูุน ุชุญูู ูู ุจฺฉโุงููุฏ ู ุฏุชุงุจุณ (VirtinSaz)

ุงู ุณูุฏ ุชุญูู ุนูู ู ุชุฎุตุต ุงุฒ ุณุงุฎุชุงุฑ ุฏุชุงุจุณุ ูุนูุงุฑ ฺฉุฏ ู ุฌุฑุงู ุฏุงุฏู ุฏุฑ ูพูุชูุฑู ุณุงุชโุณุงุฒ **VirtinSaz** ุงุณุช.

---

## ๐พ ฑ. ูุนูุงุฑ ู ุณุงุฎุชุงุฑ ุฏุชุงุจุณ (Database Schema)

ุฏุชุงุจุณ ูพุฑูฺู ุจุฑ ูพุงู ูุฏูโูุง Django ORM ุทุฑุงุญ ุดุฏู ู ุงุฒ ุฑูุงุจุท ูพฺุฏู ุจุฑุง ูุฏุฑุช Multi-tenancy ุงุณุชูุงุฏู ูโฺฉูุฏ.

### ๐ฅ ุจุฎุด ุงุญุฑุงุฒ ููุช (Accounts)
- **User Table (`accounts_user`):**
    - `phone_number`: ฺฉูุฏ ุงุตู ู ุดูุงุณู ูุฑูุฏ (Unique CharField).
    - `full_name`, `email`, `restaurant_name`: ุงุทูุงุนุงุช ูพุฑููุงู.
    - `password`: ุฐุฎุฑู ุจู ุตูุฑุช Hash ุดุฏู (PBKDF2).
    - `is_verified`: ุชุงุฏู ุงููุช ุจุฑุง ุฏุณุชุฑุณ ุจู ูพูู ูุฏุฑุช.
- **OTP Table (`accounts_otp`):**
    - `code`: ฺฉุฏ ถ ุฑูู ุชุตุงุฏู.
    - `created_at`: ุฒูุงู ุงููุถุง ุจุฑ ุงุณุงุณ ต ุฏููู ุงุฒ ูุญุธู ุงุฌุงุฏ.
    - `is_used`: ุฌููฺฏุฑ ุงุฒ ุงุณุชูุงุฏู ูุฌุฏุฏ ุงุฒ ฺฉ ฺฉุฏ.

### ๐ ุจุฎุด ูุณุชู ุณุงุชโุณุงุฒ (Sites)
- **SiteCategory (`sites_sitecategory`):** ุฏุณุชูโุจูุฏ ุงุตู ุณุงุชโูุง (ูุซูุงู Restaurant).
- **Template (`sites_template`):**
    - `source_identifier`: ูุงู ูพูุดู ุง ุดูุงุณูโุง ฺฉู ูุฑุงูุชโุงููุฏ ุจุฑุง ููุฏ ฺฉุฑุฏู ฺฉุงููพูููุชโูุง ุจุตุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ.
    - `default_settings`: ููุฏ JSON ุดุงูู ุณุงุฎุชุงุฑ ุงููู ุณุงุช (ุฑูฺฏโูุงุ ุจุฎุดโูุงุ ุชูุธูุงุช ูุฏุฑ).
- **Site (`sites_site`):**
    - **OneToOne with User:** ูุฑ ฺฉุงุฑุจุฑ ุฏููุงู ฺฉ ุณุงุช ุฏุงุฑุฏ.
    - `slug`: ุดูุงุณู ฺฉุชุง ุฏุฑ URL (ูุซูุงู `my-cafe`). ูพุดุชุจุงู ุงุฒ **Unicode** ุจุฑุง ุขุฏุฑุณโูุง ูุงุฑุณ.
    - `settings`: ููุฏ JSON ฺฉู ุจุฑ ุฑู `default_settings` ูุงูุจ Overwrite ูโุดูุฏ. ุงู ููุจู ุดุฎุตโุณุงุฒ ุณุณุชู ุงุณุช.

### ๐ ุจุฎุด ูุงฺูู ุฑุณุชูุฑุงู (Menu)
- **ProductCategory:** ุฏุณุชูโุจูุฏ ูุญุตููุงุช (ูุซูุงู ููุดุฏูุ ูพุชุฒุง). ุฏุงุฑุง ููุฏ `order` ุจุฑุง ฺุฏูุงู ุฏุณุช ุฏุฑ ููู.
- **Product:**
    - `price`: ุฐุฎุฑู ุจู ุตูุฑุช **BigIntegerField** (ุชููุงู) ุจุฑุง ุฏูุช ุฏุฑ ูุญุงุณุจุงุช ูุงู.
    - `discount_percentage`: ููุฏ ุนุฏุฏ ุจุฑุง ุงุนูุงู ุชุฎูู ุฏุฑ ุณุทุญ ุงูพูฺฉุดู.
    - `is_popular` & `is_available`: ูพุฑฺูโูุง ููุทู ุจุฑุง ฺฉูุชุฑู ููุงุด ุฏุฑ ูุฑุงูุชโุงููุฏ.
- **ProductTag:** ุณุณุชู ุชฺฏโฺฏุฐุงุฑ ูุญุตููุงุช (ูุซูุงู "ุชูุฏ"ุ "ูพุดููุงุฏ ุณุฑุขุดูพุฒ") ุจุง ฺฉุฏ ุฑูฺฏ ุงุฎุชุตุงุต.

---

## ๐ฃ๏ธ ฒ. ฺฉุงุชุงููฺฏ APIูุง ู ุฏุณุชุฑุณโูุง

ุจฺฉโุงููุฏ ูพุฑูฺู ุงุฒ **Django REST Framework (DRF)** ุงุณุชูุงุฏู ูโฺฉูุฏ.

### ๐ ุงููุช ู ุงุญุฑุงุฒ ููุช
- **JWT (SimpleJWT):** ุชูุงู APIูุง ุจุฎุด ูุฏุฑุช ูุงุฒ ุจู ุชูฺฉู Bearer ุฏุงุฑูุฏ.
- **Access Token:** ุงููุถุง ฑ ุฑูุฒ.
- **Refresh Token:** ุงููุถุง ท ุฑูุฒ.

### ๐ก ูุณุช Endpoints ฺฉูุฏ:

| ูุณุฑ API | ูุชุฏ | ุฏุณุชุฑุณ | ุชูุถุญุงุช |
| :--- | :--- | :--- | :--- |
| `/api/accounts/register/` | POST | AllowAny | ุซุจุชโูุงู ู ุฏุฑุงูุช ุชูฺฉู ุงููู |
| `/api/site/me/` | GET | Authenticated | ุฏุฑุงูุช ุงุทูุงุนุงุช ฺฉุงูู ุณุงุชู ฺฉุงุฑุจุฑ ูุนู |
| `/api/site/settings/` | PATCH | Authenticated | ุขูพุฏุช JSON ุชูุธูุงุช ู ุขูพููุฏ ููฺฏู/ฺฉุงูุฑ |
| `/api/menu/products/` | CRUD | Authenticated | ูุฏุฑุช ูุญุตููุงุช ุจุง ููุชุฑ ุฎูุฏฺฉุงุฑ `site_id` |
| `/api/site/public/<slug>/` | GET | AllowAny | ุฏุฑุงูุช ุงุทูุงุนุงุช ูพุงู ุณุงุช ุจุฑุง ุจุงุฒุฏุฏฺฉููุฏู |
| `/api/menu/public-data/<slug>/` | GET | AllowAny | ุฏุฑุงูุช ฺฉุงูู ูุญุตููุงุช ู ุฏุณุชูโูุง ุฏุฑ ฺฉ ูพุงุณุฎ |

---

## โ๏ธ ณ. ููุทู ุชุฌุงุฑ (Business Logic)

### ๐ ุฌุฑุงู ุณุงุฎุช ุณุงุช (Site Provisioning)
ุฒูุงู ฺฉู ฺฉุงุฑุจุฑ ุซุจุชโูุงู ูโฺฉูุฏุ ุจฺฉโุงููุฏ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
1.  ฺฉุงุฑุจุฑ ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ.
2.  ุจุฑ ุงุณุงุณ `category_id` ู `template_id` ุงูุชุฎุงุจุ ฺฉ ููููู ุงุฒ `Site` ูโุณุงุฒุฏ.
3.  ุชูุธูุงุช ูพุดโูุฑุถ ูุงูุจ ุฑุง ุฏุฑ ููุฏ `settings` ุณุงุช ฺฉูพ ูโฺฉูุฏ.
4.  ูุงู ุณุงุช ุฑุง ุจุฑ ุงุณุงุณ ูุงู ุฑุณุชูุฑุงู ุง ุดูุงุฑู ููุจุงู ฺฉุงุฑุจุฑ `slugify` ูโฺฉูุฏ.

### ๐ก๏ธ ุงุฒููุงุณูู ุฏุงุฏูโูุง (Data Isolation)
ุงุฒ ุทุฑู `SiteSpecificMixin` ุฏุฑ ูุงู `menu/views.py`:
- ุฏุฑ ูุฑ ุฏุฑุฎูุงุณุช (GET, POST, ...)ุ ุณุณุชู ุงุจุชุฏุง `request.user.site` ุฑุง ูพุฏุง ูโฺฉูุฏ.
- ุชูุงู ฺฉูุฆุฑโูุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุง `.filter(site=site)` ูุญุฏูุฏ ูโุดููุฏ.
- ุญุช ุงฺฏุฑ ฺฉุงุฑุจุฑ ID ูุญุตูู ฺฉุงุฑุจุฑ ุฏฺฏุฑ ุฑุง ุจุฏุงูุฏุ ุณุณุชู ุงุฌุงุฒู ุฏุณุชุฑุณ ุง ุชุบุฑ ุฑุง ููโุฏูุฏ.

### ๐จ ุณุณุชู ูุงูุจโุจูุฏ ุฏูุงูฺฉ
- ูุงูุจโูุง ูุงุฑุฏฺฉุฏ ูุณุชูุฏ. ููุฏ `source_identifier` ุจู ูุฑุงูุชโุงููุฏ ูโฺฏูุฏ ฺฉุฏุงู Layout ุฑุง ุฑูุฏุฑ ฺฉูุฏ.
- ุชูุงู ุชุบุฑุงุช ุจุตุฑ (ุฑูฺฏ ูพุณโุฒูููุ ูููุชุ ูุชูโูุง ุจูุฑ) ุฏุฑ ฺฉ ุขุจุฌฺฉุช JSON ุฐุฎุฑู ูโุดููุฏ ฺฉู ุงูุนุทุงูโูพุฐุฑ ฑฐฐูช ุจุฏูู ุชุบุฑ ุฏุฑ ฺฉุฏ ุจฺฉโุงููุฏ ุฑุง ูุฑุงูู ูโฺฉูุฏ.

---

## ๐ ด. ุชุญูู ูู ู ูพุดููุงุฏุงุช ุจุฑุง ูุชุฎุตุต

- **Performance:** ุฏุฑ ุจุฎุด ููู ุงุฒ `.select_related('category')` ู `.prefetch_related('tags')` ุงุณุชูุงุฏู ุดุฏู ุชุง ูุดฺฉู N+1 ฺฉูุฆุฑ ุญู ุดูุฏ.
- **Storage:** ููุฏูุง ุจุฑุง ุฐุฎุฑู ุชุตุงูุฑ (`ImageField`) ุขูุงุฏู ุดุฏูโุงูุฏ ู ุฏุฑ ุญุงู ุญุงุถุฑ ุฏุฑ `MEDIA_ROOT` ูุญู ุฐุฎุฑู ูโุดููุฏ (ุชูุตู: ุงุณุชูุงุฏู ุงุฒ S3 ุฏุฑ Production).
- **Scalability:** ูุนูุงุฑ ุจู ฺฏูููโุง ุงุณุช ฺฉู ุงูุฒูุฏู ูุงฺููโูุง ุฌุฏุฏ (ูุงููุฏ "ุฑุฒุฑูุงุณูู" ุง "ูุธุฑุงุช") ููุท ุจุง ุงุถุงูู ฺฉุฑุฏู ฺฉ ุงูพูฺฉุดู ุฌุฏุฏ ู ุงุชุตุงู ุขู ุจู `site_id` ููฺฉู ุงุณุช.
- **Data Integrity:** ุงุณุชูุงุฏู ุงุฒ `transaction.atomic` ุฏุฑ ูุฑุงูุฏ ุซุจุชโูุงู ุชุถูู ูโฺฉูุฏ ฺฉู ุง ฺฉุงุฑุจุฑ ู ุณุงุช ุจุง ูู ุณุงุฎุชู ูโุดููุฏ ู ุง ูฺโฺฉุฏุงู (ุฌููฺฏุฑ ุงุฒ ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุจุฏูู ุณุงุช).
